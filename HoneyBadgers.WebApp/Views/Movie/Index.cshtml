@model List<HoneyBadgers.Logic.Dto.MovieDto>
@using HoneyBadgers.Logic.Enums
@using Microsoft.AspNetCore.Identity
@using HoneyBadgers.Entity.Models
@inject SignInManager<ApplicationUser> SignInManager

@{
    ViewData["Title"] = "Movies";
}

<div class="container mt-3">
    <div class="row m-3">
        <form class="d-flex col-6">
            <select id="filter-type" class="hb-movie-select" name="FilterType" asp-items="Html.GetEnumSelectList<SortType>()"></select>
        </form>
        @if (SignInManager.IsSignedIn(User))
        {
            <div class="d-flex col-6">
                <input class="d-flex m-2" type="checkbox" id="isFavorite" />
                <label class="d-flex m-1">Only favorite movies</label>
            </div>
        }

    </div>
    <div class="m-3 col-4">
        <div class="d-flex mt-3">
            <input type="number" class="form-control col-4 mx-1" id="ratingFrom" min="0" max="10" placeholder="1 - 10"/>
            <input type="number" class="form-control col-4 mx-1" id="ratingTo" min="0" max="10" placeholder="1 - 10"/>
            <button class="form-control mx-1 " id="SearchByRating">Search</button>
        </div>
        <span id="error" class="ml-2"></span>
    </div>
</div>
<div id="movies-list">
    <partial name="../Shared/_MoviePartialView.cshtml" model="@Model" />
</div>

@section Scripts{
    <script>
        var filterValue, ratingFrom, ratingTo, isFavorite;
        $(function () {
            $("#filter-type").change(function () {
                filterValue = $(this).val();
                $.ajax({
                    type: "Get",
                    url: "/Movie/ShowMovies?sortType=" + filterValue + "&ratingFrom=" + ratingFrom + "&ratingTo=" + ratingTo + "&isFavorite=" + isFavorite,
                    success: function (data) {
                        $("#movies-list").html("");
                        $("#movies-list").html(data);
                    },
                    error: function (response) {
                        console.log(response.responseText);
                    }
                });
            });
            $("#SearchByRating").click(function () {
                ratingFrom = $("#ratingFrom").val();
                ratingTo = $("#ratingTo").val();
                var error = document.getElementById("error");
                error.textContent = "";

                if (ratingFrom < 0 || ratingFrom > 10 || ratingTo < 0 || ratingTo > 10) {
                    error.textContent = "Value is out of range";
                    error.style.color = "red";
                    return false;
                } else {
                    $.ajax({
                        type: "Get",
                        url: "/Movie/ShowMovies?sortType=" + filterValue + "&ratingFrom=" + ratingFrom + "&ratingTo=" + ratingTo + "&isFavorite=" + isFavorite,
                        success: function (data) {
                            $("#movies-list").html("");
                            $("#movies-list").html(data);
                        },
                        error: function (response) {
                            console.log(response.responseText);
                        }
                    });
                }
            });
            $("#isFavorite").click(function () {
                isFavorite = $("#isFavorite").prop("checked");
                $.ajax({
                    type: "Get",
                    url: "/Movie/ShowMovies?sortType=" + filterValue + "&ratingFrom=" + ratingFrom + "&ratingTo=" + ratingTo + "&isFavorite=" + isFavorite,
                    success: function (data) {
                        $("#movies-list").html("");
                        $("#movies-list").html(data);
                    },
                    error: function (respose) {
                        console.log(response.responseText);
                    }
                })
            });


        });

    </script>
}